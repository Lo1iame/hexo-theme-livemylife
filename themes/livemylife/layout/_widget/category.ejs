<!-- Categories -->
<% if (site.categories.length){ %>
<h5><a href="<%= config.root %><%= page.lang %>/categories/"><%= __('categories') %></a></h5>
<div class="widget">

  <%
    var lang;
    var currentURL = page.path.split('/') ;
    if (currentURL.length === 1) {
      lang = page.lang ;
    } else {
      lang = currentURL.shift();
    }

    var categories = site.categories.map(function(category){
      let cps = category.posts.filter(function(post){
        return post.lang == lang;
      });
      if(cps.length !== 0){
        let newCategory = Object.assign({},category);
        newCategory['posts'] = cps;
        return newCategory;
      }
      return;
    }).filter(Boolean);
  %>

  <ul>
    <% categories.map(function(category){ %>
    <a href="<%= config.root %><%= page.lang %>/categories/#<%= category.name %>">
      <li><%= category.name %></li>
    </a>
    <% }) %>
  </ul>
</div>
<% } %>
